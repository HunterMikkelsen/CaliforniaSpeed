$('#game_div').hide();


var connection = new signalR.HubConnectionBuilder().withUrl("/gameHub").build();
var connectionId = (Math.random() + 1).toString(36).substring(7);
var player = "";
connection.start().then(function () {
    //connectionId = connection.connection.connectionId;
    connection.invoke('JoinGame', connection.connectionId);
}).catch(function (err) {
    return console.error(err.toString());
});

connection.on("UpdatePlayer", function (player_number) {
    player = player_number;
    connectionId = connection.connectionId;
    if (player == "player_one" || player == "player_two") {
        connection.invoke("StartGame", player);
    }
});

connection.on("UpdateGame", function (my_hand, my_count, play_one, play_two, opp_count) {

    $('#game_div').show();
    $('#waiting_for_game').hide();
    player_count.innerHTML = my_count;
    other_count.innerHTML = opp_count;
    pile_one.src = "../lib/cards/" + play_one;
    pile_two.src = "../lib/cards/" + play_two;
    cards = $('.drag').children();
    $(my_hand).each(function (index, element) {
        console.log(element);
        cards[index].src = "../lib/cards/" + element;
    });
    //my_hand_0.src = "../lib/cards/" + my_hand[0];
    //my_hand_1.src = "../lib/cards/" + my_hand[1];
    //my_hand_2.src = "../lib/cards/" + my_hand[2];
    //my_hand_3.src = "../lib/cards/" + my_hand[3];
    //my_hand_4.src = "../lib/cards/" + my_hand[4];
});

connection.on("ReceiveMessage", function (message) {
    console.log(message);
});

$('.drag').draggable({
    appendTo: 'body',
    helper: 'clone'
});

$('.dropzone').droppable({
    activeClass: 'active',
    hoverClass: 'hover',
    accept: ":not(.ui-sortable-helper)", // Reject clones generated by sortable
    drop: function (e, ui) {
        connection.invoke("PlayCard", player, ui.draggable[0].id, e.target.id);
    }
}).sortable({
    items: '.drop-item',
    sort: function () {
        // gets added unintentionally by droppable interacting with sortable
        // using connectWithSortable fixes this, but doesn't allow you to customize active/hoverClass options
        $(this).removeClass("active");
    }
});


